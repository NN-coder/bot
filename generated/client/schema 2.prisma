generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["deno"]
  output          = "../generated/client"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

model Student {
  id BigInt @id @default(autoincrement())

  name       String
  group      String
  isApproved Boolean @default(false)

  stars  Int @default(0) @db.Int2
  hearts Int @default(3) @db.Int2

  tgChatId   BigInt  @unique
  tgUserId   BigInt  @unique
  tgUsername String? @unique

  mentorId BigInt
  mentor   Mentor @relation(fields: [mentorId], references: [id])

  complaints Complaint[]
}

model Mentor {
  id BigInt @id @default(autoincrement())

  name       String
  group      String
  isApproved Boolean @default(false)

  tgChatId   BigInt  @unique
  tgUserId   BigInt  @unique
  tgUsername String? @unique

  students   Student[]
  complaints Complaint[]
}

model Admin {
  id BigInt @id @default(autoincrement())

  tgChatId BigInt @unique
  tgUserId BigInt @unique
}

enum ComplaintReason {
  EXCEEDING_AUTHORITY
  TRANSFER_PROHIBITION
  LABOR_EXPLOITATION
}

model Complaint {
  id BigInt @id @default(autoincrement())

  text   String
  reason ComplaintReason

  fromId BigInt
  from   Student @relation(fields: [fromId], references: [id])

  aboutId BigInt
  about   Mentor @relation(fields: [aboutId], references: [id])
}
